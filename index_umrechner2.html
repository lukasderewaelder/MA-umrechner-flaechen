<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktive Stellenwerttafel: Flächen (km² bis mm²)</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel für JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .select-none { user-select: none; -webkit-user-select: none; }
        @import url('https://fonts.googleapis.com/css2?family=Fira+Mono:wght@500;700&display=swap');
        .font-mono { font-family: 'Fira Mono', monospace; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-stone-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const Icon = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const ArrowLeftRight = (props) => <Icon {...props}><path d="M8 3 4 7l4 4"/><path d="M4 7h16"/><path d="m16 21 4-4-4-4"/><path d="M20 17H4"/></Icon>;
        const Trash2 = (props) => <Icon {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></Icon>;
        const ChevronUp = (props) => <Icon {...props}><path d="m18 15-6-6-6 6"/></Icon>;
        const ChevronDown = (props) => <Icon {...props}><path d="m6 9 6 6 6-6"/></Icon>;
        const X = (props) => <Icon {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></Icon>;
        const BookOpen = (props) => <Icon {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></Icon>;
        const LayoutGrid = (props) => <Icon {...props}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></Icon>;


        // --- CONFIGURATION ---
        // Erweitert um km², ha, a
        const UNITS = [
            { id: 'km2', label: 'km²', sub: 'Quadratkilometer', color: 'bg-fuchsia-100', border: 'border-fuchsia-200' },
            { id: 'ha',  label: 'ha',  sub: 'Hektar',           color: 'bg-rose-100',    border: 'border-rose-200' },
            { id: 'a',   label: 'a',   sub: 'Ar',               color: 'bg-orange-100',  border: 'border-orange-200' },
            { id: 'm2',  label: 'm²',  sub: 'Quadratmeter',     color: 'bg-yellow-100',  border: 'border-yellow-200' },
            { id: 'dm2', label: 'dm²', sub: 'Quadratdezimeter', color: 'bg-green-100',   border: 'border-green-200' },
            { id: 'cm2', label: 'cm²', sub: 'Quadratzentimeter',color: 'bg-teal-100',    border: 'border-teal-200' },
            { id: 'mm2', label: 'mm²', sub: 'Quadratmillimeter',color: 'bg-blue-100',    border: 'border-blue-200' },
        ];

        // Faktoren relativ zu mm² (Einer)
        const COLUMNS = [
            // km²
            { id: 'km2_10', unitId: 'km2', label: 'Z', factor: 10000000000000 }, 
            { id: 'km2_1',  unitId: 'km2', label: 'E', factor: 1000000000000 }, 
            // ha
            { id: 'ha_10',  unitId: 'ha',  label: 'Z', factor: 100000000000 }, 
            { id: 'ha_1',   unitId: 'ha',  label: 'E', factor: 10000000000 },
            // a
            { id: 'a_10',   unitId: 'a',   label: 'Z', factor: 1000000000 }, 
            { id: 'a_1',    unitId: 'a',   label: 'E', factor: 100000000 },
            // m²
            { id: 'm2_10',  unitId: 'm2',  label: 'Z', factor: 10000000 }, 
            { id: 'm2_1',   unitId: 'm2',  label: 'E', factor: 1000000 }, 
            // dm²
            { id: 'dm2_10', unitId: 'dm2', label: 'Z', factor: 100000 }, 
            { id: 'dm2_1',  unitId: 'dm2', label: 'E', factor: 10000 },
            // cm²
            { id: 'cm2_10', unitId: 'cm2', label: 'Z', factor: 1000 },
            { id: 'cm2_1',  unitId: 'cm2', label: 'E', factor: 100 },
            // mm²
            { id: 'mm2_10', unitId: 'mm2', label: 'Z', factor: 10 },
            { id: 'mm2_1',  unitId: 'mm2', label: 'E', factor: 1 },
        ];

        function App() {
            const [digits, setDigits] = useState({});
            const [sliderColId, setSliderColId] = useState('m2_1'); // Start bei m²
            const [showInstructions, setShowInstructions] = useState(false);
            const [isDragging, setIsDragging] = useState(false);
            
            const colRefs = useRef({});

            // Logic: Ziffern ändern
            const updateDigit = (colId, value) => {
                setDigits(prev => {
                    const next = { ...prev };
                    if (value === '' || value === null) delete next[colId];
                    else {
                        const cleanVal = value.toString().slice(-1); 
                        if (/[0-9]/.test(cleanVal)) next[colId] = cleanVal;
                    }
                    return next;
                });
            };

            const incrementDigit = (colId) => {
                setDigits(prev => {
                    const currentVal = prev[colId] ? parseInt(prev[colId]) : null;
                    let nextVal = currentVal === null ? 1 : (currentVal === 9 ? 0 : currentVal + 1);
                    return { ...prev, [colId]: nextVal.toString() };
                });
            };

            const decrementDigit = (colId) => {
                setDigits(prev => {
                    const currentVal = prev[colId] ? parseInt(prev[colId]) : null;
                    if (currentVal === null) return { ...prev, [colId]: '9' };
                    if (currentVal === 0) {
                        const copy = { ...prev };
                        delete copy[colId];
                        return copy;
                    }
                    return { ...prev, [colId]: (currentVal - 1).toString() };
                });
            };

            const clearAll = () => setDigits({});

            const handleWheel = (e, colId) => {
                if (e.deltaY < 0) incrementDigit(colId);
                else if (e.deltaY > 0) decrementDigit(colId);
            };

            // Logic: Drag & Drop
            const handleDragStart = (e) => {
                setIsDragging(true);
                if(e.type === 'mousedown') e.preventDefault();
            };

            useEffect(() => {
                const handleDragMove = (e) => {
                    if (!isDragging) return;

                    const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                    
                    let closestColId = null;
                    let minDist = Infinity;

                    Object.entries(colRefs.current).forEach(([id, element]) => {
                        if (!element) return;
                        const rect = element.getBoundingClientRect();
                        
                        if (clientX >= rect.left && clientX <= rect.right) {
                            closestColId = id;
                            minDist = 0; 
                        } else {
                            const center = rect.left + rect.width / 2;
                            const dist = Math.abs(clientX - center);
                            if (dist < minDist) {
                                minDist = dist;
                                closestColId = id;
                            }
                        }
                    });

                    if (closestColId && closestColId !== sliderColId) {
                        setSliderColId(closestColId);
                    }
                };

                const handleDragEnd = () => {
                    setIsDragging(false);
                };

                if (isDragging) {
                    window.addEventListener('mousemove', handleDragMove);
                    window.addEventListener('mouseup', handleDragEnd);
                    window.addEventListener('touchmove', handleDragMove, { passive: false });
                    window.addEventListener('touchend', handleDragEnd);
                }

                return () => {
                    window.removeEventListener('mousemove', handleDragMove);
                    window.removeEventListener('mouseup', handleDragEnd);
                    window.removeEventListener('touchmove', handleDragMove);
                    window.removeEventListener('touchend', handleDragEnd);
                };
            }, [isDragging, sliderColId]);

            // Logic: Calculation
            const calculateOutput = () => {
                let total = 0;
                Object.entries(digits).forEach(([colId, digitStr]) => {
                    const col = COLUMNS.find(c => c.id === colId);
                    if (col && digitStr) total += parseInt(digitStr) * col.factor;
                });
                
                if (total === 0 && Object.keys(digits).length === 0) return "0";

                const sliderCol = COLUMNS.find(c => c.id === sliderColId);
                const result = total / sliderCol.factor;
                
                // Erhöhte Präzision für Umrechnungen wie mm² -> km²
                return result.toLocaleString('de-DE', { maximumFractionDigits: 12 });
            };

            const getCellDisplay = (colId) => {
                const realDigit = digits[colId];
                if (realDigit !== undefined) return { value: realDigit, type: 'real' };

                const sliderIndex = COLUMNS.findIndex(c => c.id === sliderColId);
                const colIndex = COLUMNS.findIndex(c => c.id === colId);
                const occupiedIndices = COLUMNS.map((c, i) => digits[c.id] !== undefined ? i : -1).filter(i => i !== -1);
                
                if (occupiedIndices.length === 0) return { value: '', type: 'empty' };

                const minOccupied = Math.min(...occupiedIndices);
                const maxOccupied = Math.max(...occupiedIndices);

                if (colIndex > minOccupied && colIndex < maxOccupied) return { value: '0', type: 'ghost' };
                if (colIndex > maxOccupied && colIndex <= sliderIndex) return { value: '0', type: 'ghost' };
                if (colIndex < minOccupied && colIndex >= sliderIndex) return { value: '0', type: 'ghost' };

                return { value: '', type: 'empty' };
            };

            const getUnitForCol = (unitId) => UNITS.find(u => u.id === unitId);
            const getSliderUnitLabel = () => {
                const col = COLUMNS.find(c => c.id === sliderColId);
                const unit = getUnitForCol(col.unitId);
                return unit ? unit.label : '';
            };

            return (
                <div className={`min-h-screen font-sans flex flex-col items-center p-2 md:p-6 select-none relative ${isDragging ? 'cursor-ew-resize' : ''}`}>
                
                {/* Header */}
                <div className="w-full max-w-6xl flex flex-col md:flex-row justify-between items-end mb-6 pb-4 border-b border-stone-200 gap-4">
                    <div>
                    <h1 className="text-3xl font-bold text-slate-700 flex items-center gap-3">
                        <LayoutGrid className="text-indigo-600" size={32} />
                        Flächen-Tafel
                    </h1>
                    <p className="text-stone-500 mt-1 ml-1">Von km² bis mm² – Jede Einheit hat zwei Stellen.</p>
                    </div>
                    
                    <div className="flex gap-2">
                        <button 
                            onClick={() => setShowInstructions(true)}
                            className="flex items-center gap-2 px-4 py-2 text-indigo-600 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition-colors font-medium text-sm"
                        >
                            <BookOpen size={18} />
                            Anleitung
                        </button>
                        <button 
                            onClick={clearAll}
                            className="flex items-center gap-2 px-4 py-2 text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors font-medium text-sm"
                        >
                            <Trash2 size={18} />
                            Alles löschen
                        </button>
                    </div>
                </div>

                {/* --- THE INTERACTIVE BOARD --- */}
                {/* Scroll-Container: Breite für 7 Einheiten * 2 Spalten angepasst */}
                <div className="w-full max-w-7xl overflow-x-auto pb-12 px-2 no-scrollbar touch-pan-x">
                    <div className="min-w-[1000px] relative">
                        
                        {/* 1. UNIT Header Row - Clickable Buttons */}
                        {/* 7 Einheiten * 2 Spalten = 14 Columns Grid */}
                        <div className="grid grid-cols-[repeat(14,minmax(0,1fr))] gap-1 mb-2">
                            {UNITS.map((unit) => {
                                const targetColId = `${unit.id}_1`;
                                const isTargetActive = sliderColId === targetColId;

                                return (
                                    <button
                                        key={unit.id}
                                        onClick={() => setSliderColId(targetColId)}
                                        className={`
                                            col-span-2 relative h-20 rounded-xl border-b-4 flex flex-col items-center justify-center transition-all duration-200 group
                                            ${unit.color} ${unit.border}
                                            ${isTargetActive 
                                                ? 'translate-y-1 shadow-inner border-t-4 border-t-black/5 ring-2 ring-red-500 ring-offset-2 z-10' 
                                                : 'hover:-translate-y-1 shadow-md hover:shadow-lg'
                                            }
                                        `}
                                    >
                                        <span className="text-3xl font-bold text-slate-700 block mb-1">{unit.label}</span>
                                        <span className="text-[10px] uppercase tracking-wider text-slate-500 font-semibold opacity-70 group-hover:opacity-100">
                                            {unit.sub}
                                        </span>
                                        {isTargetActive && (
                                             <div className="absolute -bottom-4 text-red-600 animate-bounce">
                                                <ChevronDown size={24} fill="currentColor" />
                                             </div>
                                        )}
                                    </button>
                                );
                            })}
                        </div>

                        {/* 2. Grid Cells */}
                        <div className="grid grid-cols-[repeat(14,minmax(0,1fr))] gap-1 bg-stone-200 p-2 rounded-2xl shadow-inner border border-stone-300">
                            {COLUMNS.map((col, index) => {
                                const display = getCellDisplay(col.id);
                                const isSliderActive = sliderColId === col.id;
                                const unit = getUnitForCol(col.unitId);
                                
                                return (
                                    <div 
                                        key={col.id}
                                        ref={el => colRefs.current[col.id] = el}
                                        onWheel={(e) => handleWheel(e, col.id)}
                                        onClick={() => setSliderColId(col.id)}
                                        className={`
                                            relative flex flex-col items-center bg-white shadow-sm border-y border-stone-100 cursor-ns-resize hover:shadow-md transition-shadow
                                            ${col.label === 'Z' ? 'rounded-l-lg ml-0.5 border-l' : ''}
                                            ${col.label === 'E' ? 'rounded-r-lg mr-0.5 border-r' : ''}
                                        `}
                                    >
                                        <div className={`w-full text-center py-1 text-[10px] font-bold text-slate-400 border-b border-stone-50 ${unit.color.replace('100', '50')}`}>
                                            {col.label}
                                        </div>

                                        {isSliderActive && (
                                            <div 
                                                onMouseDown={handleDragStart}
                                                onTouchStart={handleDragStart}
                                                className="absolute right-0 top-0 bottom-0 w-8 translate-x-1/2 z-30 cursor-ew-resize flex justify-center items-center touch-none group"
                                                title="Komma verschieben"
                                            >
                                                <div className="w-1.5 h-full bg-red-500 shadow-[0_0_15px_rgba(239,68,68,0.6)] relative transition-transform group-hover:scale-x-125">
                                                    <div className="absolute -right-3 top-2 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded shadow-sm select-none pointer-events-none">
                                                        KOMMA
                                                    </div>
                                                    <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-red-600 text-white p-1 rounded-full shadow-md opacity-0 group-hover:opacity-100 transition-opacity">
                                                        <ArrowLeftRight size={14} />
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        <button 
                                            onClick={(e) => { e.stopPropagation(); incrementDigit(col.id); }}
                                            tabIndex={-1}
                                            className="w-full h-8 flex items-center justify-center text-stone-300 hover:text-indigo-600 hover:bg-indigo-50 active:bg-indigo-100 transition-colors"
                                        >
                                            <ChevronUp size={20} strokeWidth={3} />
                                        </button>

                                        <div className="relative w-full h-20 flex items-center justify-center">
                                            <input
                                                type="text" 
                                                inputMode="numeric"
                                                value={display.type === 'real' ? display.value : ''}
                                                placeholder={display.type === 'ghost' ? display.value : ''}
                                                onChange={(e) => updateDigit(col.id, e.target.value)}
                                                className={`
                                                    w-full h-full text-center text-4xl font-mono font-bold bg-transparent outline-none
                                                    ${display.type === 'real' ? 'text-slate-800' : 'placeholder:text-red-300 placeholder:opacity-100'}
                                                `}
                                            />
                                            {display.type === 'ghost' && (
                                                <div className="absolute top-1 left-1 text-[8px] font-bold text-red-300 uppercase tracking-widest pointer-events-none">
                                                    Auto
                                                </div>
                                            )}
                                        </div>

                                        <button 
                                            onClick={(e) => { e.stopPropagation(); decrementDigit(col.id); }}
                                            tabIndex={-1}
                                            className="w-full h-8 flex items-center justify-center text-stone-300 hover:text-indigo-600 hover:bg-indigo-50 active:bg-indigo-100 transition-colors"
                                        >
                                            <ChevronDown size={20} strokeWidth={3} />
                                        </button>
                                        
                                        {isSliderActive && (
                                            <div className="absolute -bottom-6 text-red-600 animate-bounce">
                                                <ChevronDown size={24} fill="currentColor" />
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>

                        {/* 3. Footer Labels */}
                        <div className="grid grid-cols-[repeat(14,minmax(0,1fr))] gap-1 mt-4 px-2">
                             {UNITS.map((unit) => (
                                <div 
                                    key={unit.id}
                                    className="col-span-2 text-center"
                                >
                                    <span className="text-xs font-bold text-stone-400 uppercase tracking-wider block">
                                        {unit.label}
                                    </span>
                                </div>
                            ))}
                        </div>

                    </div>
                </div>

                {/* RESULT CARD */}
                <div className="fixed bottom-6 z-40 animate-in slide-in-from-bottom-4 fade-in duration-500">
                    <div className="bg-stone-800/95 backdrop-blur-md text-white p-6 rounded-2xl shadow-2xl border border-stone-600 flex items-center gap-6 min-w-[300px]">
                        <div>
                            <div className="text-stone-400 text-xs font-bold uppercase tracking-wider mb-1">Ergebnis</div>
                            <div className="text-4xl font-mono font-bold text-green-400 tabular-nums tracking-tight">
                                {calculateOutput()}
                            </div>
                        </div>
                        <div className="h-12 w-px bg-stone-600"></div>
                        <div className="text-3xl font-bold text-white">
                            {getSliderUnitLabel()}
                        </div>
                    </div>
                </div>

                {/* INSTRUCTION MODAL */}
                {showInstructions && (
                    <div 
                        className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200"
                        onClick={() => setShowInstructions(false)}
                    >
                        <div 
                            className="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 animate-in zoom-in-95 duration-200 relative"
                            onClick={e => e.stopPropagation()}
                        >
                            <div className="flex justify-between items-start mb-6">
                                <h2 className="text-2xl font-bold text-slate-800 flex items-center gap-3">
                                    <div className="bg-indigo-100 p-2 rounded-lg text-indigo-600">
                                        <BookOpen size={24} />
                                    </div>
                                    Anleitung: Flächen
                                </h2>
                                <button 
                                    onClick={() => setShowInstructions(false)} 
                                    className="text-stone-400 hover:text-stone-600 hover:bg-stone-100 p-2 rounded-full transition-colors"
                                >
                                    <X size={24} />
                                </button>
                            </div>
                            <div className="bg-stone-50 rounded-xl p-5 border border-stone-200">
                                <p className="mb-4 text-stone-600 font-medium">Bei Flächeneinheiten ist der Umrechnungsfaktor 100. Das bedeutet:</p>
                                <ol className="list-decimal list-outside ml-4 space-y-4 text-stone-700 leading-relaxed">
                                    <li>
                                        <strong>Pro Einheit gibt es zwei Spalten:</strong><br/>
                                        <span className="text-indigo-600 font-bold">Z</span> = Zehner und <span className="text-indigo-600 font-bold">E</span> = Einer.
                                    </li>
                                    <li>
                                        <strong>Eintragen:</strong><br/>
                                        Die Einerstelle der Zahl (z.B. die 5 bei <span className="font-mono bg-white px-1 border border-stone-200 rounded">15 m²</span>) kommt immer in das Feld <strong className="text-indigo-600">E</strong> der Einheit (hier m²).
                                    </li>
                                    <li>
                                        <strong>Ablesen:</strong><br/>
                                        Verschiebe das rote Komma hinter die <strong className="text-indigo-600">E</strong>-Spalte der Einheit, in die du umrechnen möchtest.
                                    </li>
                                </ol>
                            </div>
                            <div className="mt-6 flex justify-end">
                                <button 
                                    onClick={() => setShowInstructions(false)} 
                                    className="px-6 py-2.5 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-200"
                                >
                                    Verstanden
                                </button>
                            </div>
                        </div>
                    </div>
                )}

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>